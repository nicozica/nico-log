{% extends "base.html" %}

{% block content %}
<section class="section-head">
  <h2 class="section-title">Ahora sonando</h2>
  <p>Tema actual e historial reciente.</p>
</section>

<section class="card now-playing" data-now-playing data-now-endpoint="{{ now_api_url }}" data-now-refresh="{{ 'true' if now.refresh_enabled else 'false' }}">
  <h2 class="section-title">Actual</h2>
  <div class="now-playing-row">
    <img
      class="np-cover"
      data-now-cover
      src="/assets/img/np-placeholder.svg"
      alt="Tapa del tema actual"
      width="64"
      height="64"
      loading="lazy"
    />
    <div class="now-playing-copy">
      <p class="metric">
        <span data-now-track>{{ now.track if now.available else "No disponible" }}</span>
        <span data-now-artist-wrap{% if not now.available or not now.artist %} hidden{% endif %}>· <span data-now-artist>{{ now.artist }}</span></span>
      </p>
      <div class="actions">
        <a href="{{ now_stream_url }}" data-now-stream-link target="_blank" rel="noopener noreferrer">Abrir Blur FM ↗</a>
      </div>
    </div>
  </div>
</section>

<section class="card">
  <h2 class="section-title">Historial</h2>
  {% if now.live and history %}
  <ul class="history-list">
    {% for item in history %}
      <li>
        <strong>{{ item.track }}</strong> · {{ item.artist }}
        <span class="meta">{{ item.played_label }}</span>
      </li>
    {% endfor %}
  </ul>
  {% else %}
  <p class="meta">Historial no disponible hasta contar con una fuente en vivo.</p>
  {% endif %}
</section>
{% endblock %}
