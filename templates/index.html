{% extends "base.html" %}
{% import "partials/icons.html" as icons %}

{% block content %}
<section class="home-grid" aria-label="Panel principal">
  <h2 class="section-title home-heading">{{ latest_notes_title }}</h2>
  {% if latest_notes_subtitle %}
  <p class="section-subtitle home-subtitle">{{ latest_notes_subtitle }}</p>
  {% endif %}

  <div class="home-main">
    <div class="stack">
      {% for note in latest_notes %}
      <article class="card note-card">
        <header>
          <h3 class="card-title"><a href="/notes/{{ note.slug }}/">{{ note.title }}</a></h3>
          <p class="meta">{{ note.date_label }}</p>
        </header>
        <p>{{ note.excerpt }}</p>
        <p class="tags">
          {% for tag in note.tags %}
            <span class="pill">{{ tag }}</span>
          {% endfor %}
        </p>
        <a class="read-link" href="/notes/{{ note.slug }}/">leer</a>
      </article>
      {% endfor %}
    </div>
  </div>

  <aside class="home-side" aria-label="Columna lateral">
    <section class="card compact">
      <h2 class="section-title">Clima · {{ site.city }}</h2>
      <p class="metric">{{ weather.temp_label }}</p>
      <p class="weather-condition">
        <span class="inline-icon" aria-hidden="true">{{ icons.inline(weather.icon) }}</span>
        <span class="sr-only">Condición del clima:</span>
        <span>{{ weather.description }}</span>
      </p>
      <p class="meta">Humedad {{ weather.humidity_label }} · Viento {{ weather.wind_label }}</p>
    </section>

    <section class="card now-playing" data-now-playing data-now-endpoint="{{ now_api_url }}" data-now-refresh="{{ 'true' if now.refresh_enabled else 'false' }}">
      <h2 class="section-title">Ahora sonando</h2>
      <div class="now-playing-row">
        <img
          class="np-cover"
          data-now-cover
          src="/assets/img/blurfm-cover-default.svg"
          alt="Tapa del tema actual"
          width="64"
          height="64"
          loading="lazy"
        />
        <div class="now-playing-copy">
          <p class="now-meta-line now-meta-track">
            <span class="inline-icon" aria-hidden="true">{{ icons.inline("music") }}</span>
            <span class="sr-only">Tema:</span>
            <span class="now-meta-value" data-now-track>{{ now.track if now.available else "No disponible" }}</span>
          </p>
          <p class="now-meta-line" data-now-artist-row{% if not now.available or not now.artist %} hidden{% endif %}>
            <span class="inline-icon" aria-hidden="true">{{ icons.inline("artist") }}</span>
            <span class="sr-only">Artista:</span>
            <span class="now-meta-value" data-now-artist>{{ now.artist }}</span>
          </p>
          <p class="now-meta-line" data-now-album-row>
            <span class="inline-icon" aria-hidden="true">{{ icons.inline("album") }}</span>
            <span class="sr-only">Álbum:</span>
            <span class="now-meta-value" data-now-album>{{ now.album or "No disponible" }}</span>
          </p>
          <p class="now-meta-line" data-now-year-row>
            <span class="inline-icon" aria-hidden="true">{{ icons.inline("calendar") }}</span>
            <span class="sr-only">Año:</span>
            <span class="now-meta-value" data-now-year>{{ now.year or "No disponible" }}</span>
          </p>
          <div class="actions">
            <a href="{{ now_stream_url }}" data-now-stream-link target="_blank" rel="noopener noreferrer">Escuchar en Blur FM ↗</a>
          </div>
        </div>
      </div>
    </section>

    <section class="card compact">
      <h2 class="section-title">Links</h2>
      {% set links = links_preview[:6] %}
      {% set list_class = "link-list-compact" %}
      {% include "partials/link_list.html" %}
      <p><a href="/links/">Ver todos</a></p>
    </section>
  </aside>
</section>

<section class="tiny-thing" aria-label="Mini del día">
  <h2 class="section-title">Mini del día</h2>
  <p>{{ tiny_thing }}</p>
</section>
{% endblock %}
